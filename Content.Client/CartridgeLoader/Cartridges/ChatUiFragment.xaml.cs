using Content.Shared.PDA.Messaging.Messages;
using Content.Shared.PDA.Messaging.Recipients;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;

namespace Content.Client.CartridgeLoader.Cartridges;

[GenerateTypedNameReferences]
public sealed partial class ChatUiFragment : PanelContainer
{
    public Action<IChatMessage>? OnSendMessage;

    private readonly EntityUid _cartridge;
    private ChatUiMode _uiMode;

    private IChatRecipient[] _recipients = [];

    public ChatUiFragment(EntityUid cartridge)
    {
        RobustXamlLoader.Load(this);
        IoCManager.InjectDependencies(this);

        _cartridge = cartridge;

        Popup.SetPositionLast();

        ChangeMode(ChatUiMode.Menu);
    }

    public void UpdateState(IChatRecipient[] recipients)
    {
        _recipients = recipients;
        ChangeMode(_uiMode);
    }

    private void ChangeMode(ChatUiMode mode)
    {
        _uiMode = mode;

        Content.RemoveAllChildren();

        switch (mode)
        {
            case ChatUiMode.Menu:
                var menu = new ChatUiFragmentMenu(_recipients);
                Content.AddChild(menu);
                break;
        }
    }
}
