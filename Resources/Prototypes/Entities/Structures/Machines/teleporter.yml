- type: entity
  id: BaseTeleporter
  parent: [ SmallConstructibleMachine, BaseMachine ]
  name: Abstract Teleporter
  description: Abstractly teleporting you since 2599.
  abstract: true
  components:
  - type: InteractionOutline
  - type: Physics
    bodyType: Static
    canCollide: false
  - type: Transform
    anchored: true
    noRot: true
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.45,-0.45,0.45,0.00"
        density: 190
        mask:
          - MachineMask
  - type: Sprite
    sprite: Structures/cargo_telepad.rsi
    drawdepth: HighFloorObjects
    layers:
    - state: offline
    - state: idle
      map: ["enum.PowerDeviceVisualLayers.Powered"]
      shader: unshaded
  - type: Damageable
    damageContainer: StructuralInorganic
    damageModifierSet: StructuralMetallicStrong
  - type: DeviceList
  - type: DeviceNetwork
    deviceNetId: Wired
    receiveFrequencyId: BasicDevice
  - type: DeviceLinkSink
    ports:
      - TeleportReceiver
  - type: PowerConsumer #set power draw in teleport component, add/remove when teleporter powers on/off. See EmitterSystem for example.
    drawRate: 50 #for now, generic amount
    voltage: High
  - type: NodeContainer
    examinable: true
    nodes:
      input:
        !type:CableDeviceNode
        nodeGroupID: HVPower
  - type: Appearance
  - type: GenericVisualizer
    visuals:
      enum.PowerDeviceVisuals.Powered:
        enum.PowerDeviceVisualLayers.Powered:
          True: { visible: true }
          False: { visible: false }
  - type: CollideOnAnchor
  - type: NameIdentifier
    group: CargoTelepads
  - type: AnimationPlayer
  - type: PointLight
    radius: 1.5
    energy: 1.5
    color: "#ffffff"
  - type: LitOnPowered
  - type: Teleporter


- type: entity
  id: TeleporterScience
  parent: [BaseTeleporter, BaseTeleportBeaconStatic]
  name: teleframe core
  description: The core of an advanced device that rips holes in reality for near-instanteous travel. With time and material its capabilities can be expanded. Safety not guaranteed.
  components:
  - type: Machine
    board: TeleporterScienceMachineCircuitboard
  - type: Teleporter
    tpx: 5
    chargeDuration: 15


- type: entity
  id: BaseTeleportEffect
  abstract: true
  components:
  - type: TriggerOnSpawn
  - type: TwoStageTrigger
    triggerDelay: 5 #gets replaced by TeleporterSystem
    components:
    #- type: TeleportOnTrigger #TeleportOnTrigger gets specifically added by TeleportSystem, for some reason it doesn't accept new targets if it already exists
    - type: SoundOnTrigger #sound gets drowned out by the baseline EffectFlashTeleportFinish so this is here for more covert teleports.
      removeOnTrigger: true
      sound:
        path: /Audio/Effects/Grenades/Supermatter/supermatter_start.ogg
        volume: 5
    - type: SpawnOnTrigger
      proto: EffectFlashTeleportFinish #gets replaced by TeleporterSystem
    - type: DeleteOnTrigger

- type: entity
  id: TeleportToEffect
  parent: BaseTeleportEffect
  name: bluespace distortion
  description: Something's about to arrive...
  components:
  - type: SoundOnTrigger
    removeOnTrigger: true
    sound:
      path: /Audio/Effects/Grenades/Supermatter/whitehole_start.ogg
      volume: 5
  - type: AnchorOnTrigger
    removeOnTrigger: true
  - type: WarpPoint
    location: Teleportation Warp Point
    follow: true
  - type: AmbientSound
    enabled: true
    volume: -5
    range: 10
    sound:
      path: /Audio/Effects/Grenades/Supermatter/whitehole_loop.ogg
  - type: GravityWell
    maxRange: 2.5
    baseRadialAcceleration: -1
    baseTangentialAcceleration: -0.25
    gravPulsePeriod: 0.03
  - type: SingularityDistortion
    intensity: -75
    falloffPower: 1.5
  - type: PointLight
    enabled: true
    color: "#ffffff"
    energy: 5
    radius: 5
    softness: 1
    offset: "0, 0"

- type: entity
  id: TeleportFromEffect
  parent: BaseTeleportEffect
  name: bluespace distortion
  description: Reality pushed through a pinhole.
  components:
    - type: SoundOnTrigger
      removeOnTrigger: true
      sound:
        path: /Audio/Effects/Grenades/Supermatter/supermatter_start.ogg
        volume: 5
    - type: AnchorOnTrigger
      removeOnTrigger: true
    - type: AmbientSound
      enabled: true
      volume: -5
      range: 10
      sound:
        path: /Audio/Effects/Grenades/Supermatter/supermatter_loop.ogg
    - type: GravityWell
      maxRange: 2.5
      baseRadialAcceleration: 1
      baseTangentialAcceleration: 0.25
      gravPulsePeriod: 0.03
      minRange: 0.075
    - type: SingularityDistortion
      intensity: 75
      falloffPower: 1.5
    - type: PointLight
      enabled: true
      color: "#ffaa44"
      energy: 5
      radius: 5
      softness: 1
      offset: "0, 0"

- type: entity
  id: BaseTeleportBeacon #for items that can act as beacons
  abstract: true
  components:
    - type: TeleporterBeacon
    - type: NameIdentifier
      group: CargoTelepads

- type: entity
  id: BaseTeleportBeaconStatic #for structures that can act as beacons
  abstract: true
  parent: BaseTeleportBeacon
  components:
    - type: DeviceList
    - type: DeviceNetwork
      deviceNetId: Wired
      receiveFrequencyId: BasicDevice
    - type: DeviceLinkSource
      range: 20000 #can't link across different maps but should be able to function once set up?
      ports:
        - TeleportBeaconSender

- type: entity
  id: TeleportBeacon
  parent: [BaseFoldable, BaseTeleportBeacon]
  name: teleport beacon
  description: Can be linked to a Teleporter Console, allowing it to be targeted over any distance.
  components:
    - type: Physics
      bodyType: Dynamic
    - type: Fixtures
      fixtures:
        fix1:
          shape:
            !type:PhysShapeAabb
            bounds: "-0.25,-0.4,0.25,0.1"
          density: 20
          mask:
            - Impassable
    - type: Item
      size: Normal
      inhandVisuals:
        left:
        - state: inhand-left-beacon
        right:
        - state: inhand-right-beacon
    - type: Foldable
      folded: true
    - type: Clickable
    - type: InteractionOutline
    - type: Appearance
    - type: GenericVisualizer
      visuals:
        enum.FoldedVisuals.State:
          foldedLayer:
            True: { state: folded_extraction }
            False: { state: extraction_point }
    - type: Sprite
      sprite: Objects/Tools/fulton.rsi
      drawdepth: SmallObjects
      noRot: true
      layers:
        - state: extraction_point
          map: [ "foldedLayer" ]


